@using Sandbox.Menu
@using Sandbox.UI;
@using Sandbox.UI.Navigation;
@using Sandbox.Network;
@using System;
@inherits Panel
@implements INavigatorPage
@namespace Punt.UI

<root class="main-menu browse-custom-games-page">
    <page-header>Browse</page-header>

    <div class="game-browser">
        <div class="browser-header">
            <div class="column-name">Name</div>
            <div class="column-team-size">Team</div>
            <div class="column-map">Current Map</div>
            <div class="column-ping">Ping</div>
            <div class="column-players">Players</div>
        </div>

        <div class="browser-list">
            @foreach (var game in PlaceholderGames)
            {
                <div class="browser-entry">
                    <div class="column-name">@game.Name</div>
                    <div class="column-team-size">@game.TeamSize</div>
                    <div class="column-map">@game.Map</div>
                    <div class="column-ping">@game.Ping</div>
                    <div class="column-players">@game.Players</div>
                </div>
            }
        </div>
    </div>

</root>

@code
{
    public class GameLobby
    {
        public string Name { get; set; }
        public string TeamSize { get; set; }
        public string Map { get; set; }
        public string Ping { get; set; }
        public string Players { get; set; }
    }

    private List<GameLobby> PlaceholderGames
    {
        get
        {
            if (_placeholderGames == null)
            {
                _placeholderGames = new List<GameLobby>();
                // Generate 100 placeholder entries
                for (int i = 1; i <= 100; i++)
                {
                    _placeholderGames.Add(new GameLobby
                    {
                        Name = $"Game Server {i}",
                        TeamSize = $"{Random.Shared.Next(1, 5)}v{Random.Shared.Next(1, 5)}",
                        Map = $"Map_{Random.Shared.Next(1, 10)}",
                        Ping = $"{Random.Shared.Next(10, 200)}ms",
                        Players = $"{Random.Shared.Next(1, 20)}/{Random.Shared.Next(10, 20)}"
                    });
                }
            }
            return _placeholderGames;
        }
    }

    private List<GameLobby> _placeholderGames;

    public void OnNavigationOpen()
    {
        // Reset scroll position on the browser list
        var browserList = Descendants.FirstOrDefault(x => x.HasClass("browser-list"));
        if (browserList != null)
        {
            browserList.ScrollOffset = Vector2.Zero;
        }

        // Clear any existing page buttons first, then set this page's buttons
        MainMenuRoot.Instance?.ClearPageFooterButtons();

        MainMenuRoot.Instance?.SetPageFooterButtons(@<text>

            <div class="footer-button" onclick=@RefreshList>
                <span class="key-indicator">R</span>
                Refresh
            </div>

             <div class="footer-button" onclick=@CreateGame>
                 <span class="key-indicator">C</span>
                 Create
             </div>

        </text>);
    }

    public void OnNavigationClose()
    {
        // Clear page buttons when leaving this page
        MainMenuRoot.Instance?.ClearPageFooterButtons();
    }

    void CreateGame()
    {
        // TODO: Navigate to create game page
        Log.Info("Create game clicked");
    }

    void RefreshList()
    {
        // TODO: Refresh the game list
        Log.Info("Refresh list clicked");
    }
 







    
}

